import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-9001c7c7.js";import{d as a,q as t,e as l,F as o,r,M as i,a as s,o as n,c as d,w as m,f as u,t as p,A as c,L as f,i as v,Q as _,K as h,k as j,N as g}from"./index-0f2f4131.js";import{_ as y}from"./Table.vue_vue_type_script_lang-7214dc8a.js";import{E as x}from"./el-button-2439abc8.js";import{d as b}from"./Form-baf5d56a.js";import"./tsxHelper-0603e3f3.js";import{E as D}from"./el-input-67df89d4.js";import{E as w}from"./el-divider-06c47061.js";import{g as k,b as S,c as C,e as V}from"./index-f05fa6ad.js";import{u as E}from"./useTable-6de26a90.js";import{_ as N}from"./Search.vue_vue_type_script_setup_true_lang-ccf0603c.js";import{_ as R}from"./Write.vue_vue_type_script_setup_true_lang-923851e5.js";import{_ as z}from"./Detail.vue_vue_type_script_setup_true_lang-60c5cc86.js";import{_ as I}from"./Dialog.vue_vue_type_style_index_0_lang-1f82cced.js";import{u as L}from"./useCrudSchemas-20b8fa2c.js";import"./el-card-a4dbbdba.js";import"./el-popper-988e2eb3.js";import"./constants-d2900520.js";import"./el-tag-da1c3460.js";import"./use-form-common-props-8f4d7aa8.js";import"./el-pagination-4c9d35b5.js";import"./el-select-6b72a57b.js";import"./index-6f0a8630.js";import"./use-form-item-0c8a537a.js";import"./debounce-f9e067c0.js";import"./el-image-viewer-f4dbaec7.js";import"./el-dropdown-item-2b377c1f.js";import"./dropdown-552f1355.js";import"./refs-a293ed11.js";import"./el-col-e573d83e.js";import"./el-input-number-4302e5fc.js";import"./InputPassword-30095de5.js";import"./style.css_vue_type_style_index_0_src_true_lang-a2f9e27c.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-dbaeb234.js";import"./aria-ecee1d93.js";import"./index-537ccfe7.js";import"./index-090de5ab.js";import"./el-message-box-7e295404.js";import"./el-overlay-85ac7b9c.js";import"./vnode-57aa8841.js";import"./useForm-215219a6.js";import"./useIcon-bb7e183b.js";import"./useValidator-a1dbd3fd.js";import"./Descriptions-59098111.js";import"./tree-b59d36bb.js";const P={class:"flex w-100% h-100%"},T={class:"flex justify-center items-center"},A={class:"flex-1"},U={class:"mb-10px"};function K(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)}const F=a({__name:"User",setup(a){const{t:h}=j(),{tableRegister:F,tableState:O,tableMethods:W}=E({fetchDataApi:async()=>{const{pageSize:e,currentPage:a}=O,t=await S({id:s(te),pageIndex:s(a),pageSize:s(e),...s($)});return{list:t.data.list||[],total:t.data.total||0}},fetchDelApi:async()=>!!(await C(s(ce)))}),{total:H,loading:M,dataList:Q,pageSize:q,currentPage:G}=O,{getList:J,getElTableExpose:B,delList:X}=W,Y=t([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:h("userDemo.index"),form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:h("userDemo.username")},{field:"account",label:h("userDemo.account")},{field:"department.id",label:h("userDemo.department"),detail:{slots:{default:e=>l(o,null,[e.department.departmentName])}},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:async()=>(await k()).data.list},table:{type:"index"}},{field:"role",label:h("userDemo.role"),search:{hidden:!0}},{field:"email",label:h("userDemo.email"),form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:h("userDemo.createTime"),form:{component:"Input"},search:{hidden:!0}},{field:"action",label:h("userDemo.action"),form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:e=>{let a,t,r;const i=e.row;return l(o,null,[l(x,{type:"primary",onClick:()=>ve(i,"edit")},K(a=h("exampleDemo.edit"))?a:{default:()=>[a]}),l(x,{type:"success",onClick:()=>ve(i,"detail")},K(t=h("exampleDemo.detail"))?t:{default:()=>[t]}),l(x,{type:"danger",onClick:()=>fe(i)},K(r=h("exampleDemo.del"))?r:{default:()=>[r]})])}}}}]),{allSchemas:Z}=L(Y),$=r({}),ee=e=>{G.value=1,$.value=e,J()},ae=r(),te=r(""),le=r([]);(async()=>{var e,a;const t=await k();le.value=t.data.list,te.value=t.data.list[0]&&(null==(e=t.data.list[0])?void 0:e.children)&&t.data.list[0].children[0].id||"",await g(),null==(a=s(ae))||a.setCurrentKey(te.value)})();const oe=r("");i((()=>oe.value),(e=>{s(ae).filter(e)}));const re=e=>{e.children||(te.value=e.id,G.value=1,J())},ie=(e,a)=>!e||a.departmentName.includes(e),se=r(!1),ne=r(""),de=r(),me=r(""),ue=()=>{ne.value=h("exampleDemo.add"),de.value=void 0,se.value=!0,me.value=""},pe=r(!1),ce=r([]),fe=async e=>{const a=await B();ce.value=e?[e.id]:(null==a?void 0:a.getSelectionRows().map((e=>e.id)))||[],pe.value=!0,await X(s(ce).length).finally((()=>{pe.value=!1}))},ve=(e,a)=>{var t;ne.value=h("edit"===a?"exampleDemo.edit":"exampleDemo.detail"),me.value=a,de.value={...e,department:(null==(t=s(ae))?void 0:t.getCurrentNode())||{}},se.value=!0},_e=r(),he=r(!1),je=async()=>{const e=s(_e),a=await(null==e?void 0:e.submit());if(a){he.value=!0;try{await V(a)&&(G.value=1,J())}catch(t){}finally{he.value=!1,se.value=!1}}};return(a,t)=>(n(),d("div",P,[l(s(e),{class:"flex-1"},{default:m((()=>[u("div",T,[u("div",A,p(s(h)("userDemo.departmentList")),1),l(s(D),{modelValue:oe.value,"onUpdate:modelValue":t[0]||(t[0]=e=>oe.value=e),class:"flex-[2]",placeholder:s(h)("userDemo.searchDepartment"),clearable:""},null,8,["modelValue","placeholder"])]),l(s(w)),l(s(b),{ref_key:"treeEl",ref:ae,data:le.value,"default-expand-all":"","node-key":"id","current-node-key":te.value,props:{label:"departmentName"},"filter-node-method":ie,onCurrentChange:re},null,8,["data","current-node-key"])])),_:1}),l(s(e),{class:"flex-[3] ml-20px"},{default:m((()=>[l(s(N),{schema:s(Z).searchSchema,onReset:ee,onSearch:ee},null,8,["schema"]),u("div",U,[l(s(x),{type:"primary",onClick:ue},{default:m((()=>[c(p(s(h)("exampleDemo.add")),1)])),_:1}),l(s(x),{loading:pe.value,type:"danger",onClick:t[1]||(t[1]=e=>fe())},{default:m((()=>[c(p(s(h)("exampleDemo.del")),1)])),_:1},8,["loading"])]),l(s(y),{"current-page":s(G),"onUpdate:currentPage":t[2]||(t[2]=e=>f(G)?G.value=e:null),"page-size":s(q),"onUpdate:pageSize":t[3]||(t[3]=e=>f(q)?q.value=e:null),columns:s(Z).tableColumns,data:s(Q),loading:s(M),onRegister:s(F),pagination:{total:s(H)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])])),_:1}),l(s(I),{modelValue:se.value,"onUpdate:modelValue":t[5]||(t[5]=e=>se.value=e),title:ne.value},{footer:m((()=>["detail"!==me.value?(n(),v(s(x),{key:0,type:"primary",loading:he.value,onClick:je},{default:m((()=>[c(p(s(h)("exampleDemo.save")),1)])),_:1},8,["loading"])):_("",!0),l(s(x),{onClick:t[4]||(t[4]=e=>se.value=!1)},{default:m((()=>[c(p(s(h)("dialogDemo.close")),1)])),_:1})])),default:m((()=>["detail"!==me.value?(n(),v(R,{key:0,ref_key:"writeRef",ref:_e,"form-schema":s(Z).formSchema,"current-row":de.value},null,8,["form-schema","current-row"])):_("",!0),"detail"===me.value?(n(),v(z,{key:1,"detail-schema":s(Z).detailSchema,"current-row":de.value},null,8,["detail-schema","current-row"])):_("",!0)])),_:1},8,["modelValue","title"])]))}});export{F as default};
